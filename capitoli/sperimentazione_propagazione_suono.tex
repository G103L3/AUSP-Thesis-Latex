\chapter{Sperimentazione della propagazione del suono}
\label{chap:sperimentazione_propagazione}

Il percorso metodologico ideato dalla U.S. National Institure for Occupational Safety and Health's\citep[sec.~2]{jacksha2016} nel \autoref{chap:stato_arte} 
è stato usato come riferimento per la campagna 
di misurazioni svolta in un corridoio di servizio situato a circa cinque metri sotto terra, largo 
\SI{1.2}{\meter}, lungo \SI{15}{\meter} e chiuso da una parete cieca, con una porta sul lato destro posta a \SI{10}{\meter} 
dall'origine che conduce nella camera laterale raffigurata nella \autoref{fig:planimetria_tunnel}; la deviazione a novanta gradi
 corrisponde all'accesso a questa stanza, mentre il tunnel principale resta rettilineo fino al muro finale posto a 15 metri dall'origine.\\ 
 La prova ha impiegato il dispositivo sperimentale sviluppato nella tesi, basato sulla piattaforma ESP32, 
 programmato con il protocollo definito nella parte di implementazione software \autoref{chap:implementazione_software}.\\
  Il protocollo in modalità "testing" ha riprodotto in sequenza tutte le frequenze previste dal protocollo, da \SI{1000}{\hertz} a \SI{9000}{\hertz}
   con passi di \SI{400}{\hertz}, mantenendo per ciascuna un livello in emissione di circa \SI{70}{\decibel_{SPL}} per via dell'amplificatore discusso nella
    \autoref{subsec:amplificatore}, 
    misurato all'origine con un fonometro.\\
    Le misure di attenuazione sono state raccolte con il \textbf{Fonometro Tadeto}, posato accanto alla scheda
     ricevente equipaggiata con l'implementazione software di decodifica, così da correlare in tempo reale la variazione del livello sonoro in \SI{35}{\decibel_{SPL}} con
      la percentuale di pacchetti persi al crescere della distanza; i valori registrati alimentano le curve di \autoref{fig:profilo_db}.\\

      \begin{figure}[H]
        \centering
        \begin{tikzpicture}[scale=0.4]
            % corridoio
            \fill[gray!10] (0,0) rectangle (1.2,15);
            % camera a destra
            \fill[gray!20] (1.2,9) rectangle (5.2,12);
            
            % pareti corridoio
            \draw[thick] (0,0) -- (0,15);
            \draw[thick] (1.2,0) -- (1.2,9);
            \draw[thick] (1.2,12) -- (1.2,15) -- (0,15);
            
            % pareti camera
            \draw[thick] (1.2,9) -- (5.2,9) -- (5.2,12) -- (1.2,12);
            
            % linea tratteggiata porta
            \draw[thick, dashed] (1.2,9) -- (2,9.6);
            
            % etichette
            \node[anchor=north] at (0.6,0) {Ingresso};
            \node[anchor=south] at (0.6,15) {Parete terminale};
            \node[anchor=west] at (1.2,7.5) {Porta aperta};
            \node[anchor=east] at (0,7.5) {Parete sinistra};
            
            % punti
            \filldraw[black] (0.6,0.6) circle (3pt) node[anchor=west] {Sorgente};
            \filldraw[black] (0.6,5) circle (3pt) node[anchor=west] {$P_{5\,\mathrm{m}}$};
            \filldraw[black] (0.6,10.2) circle (3pt) node[anchor=west] {$P_{10\,\mathrm{m}}$};
            \filldraw[black] (0.6,14.2) circle (3pt) node[anchor=west] {$P_{15\,\mathrm{m}}$};
            \filldraw[black] (3.2,10.5) circle (3pt) node[anchor=west] {$P_{13\,\mathrm{m}}$};
        \end{tikzpicture}
        \caption{Planimetria del corridoio sotterraneo.
         La porta sul lato destro è stata mantenuta aperta durante la prova.}
        \label{fig:planimetria_tunnel}
    \end{figure}

All'ingresso del tunnel il segnale era di \SI{70}{\decibel_{SPL}}, mentre a \SI{5}{\meter} dall'origine, il livello medio scendeva a
 \SI{65}{\decibel_{SPL}} e a \SI{10}{\meter} si attestava su \SI{62}{\decibel_{SPL}};
  il valore minimo registrato vicino alla parete finale collocata a \SI{15}{\meter} è stato di \SI{55}{\decibel_{SPL}}, confermando una perdita complessiva di circa \SI{15}{\decibel}.\\
   Attraversando la porta a destra, lasciata completamente aperta, è stata seguita la curva verso la camera larga \SI{4.25}{\meter} e lunga \SI{3.67}{\meter}.\\
   A \SI{1.5}{\meter} dall'ingresso la misura rimaneva su \SI{59}{\decibel_{SPL}}, ma collocandosi a \SI{3}{\meter} lungo la direzione principale della stanza, verso destra quindi,
    si è osservato un crollo a \SI{52}{\decibel_{SPL}}, seguito da un ulteriore assestamento a \SI{51}{\decibel_{SPL}} vicino alla parete opposta.\\
     Le componenti frequenziali tra 
     \SI{5}{\kilo\hertz} e \SI{7.4}{\kilo\hertz} hanno mostrato attenuazioni leggermente più pronunciate rispetto alle frequenze basse, ma sempre inferiori
      a \SI{2}{\decibel} di differenza rispetto al valore medio, tuttavia le bande portanti 1000Hz,8600Hz ed 9000Hz sono state preservate.\\
       Il rumore di fondo dell'ambiente sotterraneo è rimasto stabile su \SI{35}{\decibel_{SPL}}, avendo, quindi, un margine di
        \SI{16}{\decibel} anche nel punto più critico dopo la curva e permettendo al ricevente di distinguere con chiarezza i 
        pacchetti trasmessi.\\
         L'ulteriore analisi, effettuata sulla \textbf{perdita di pacchetti},  confermano che il percorso rettilineo ha mantenuto un tasso di perdita inferiore al
         \SI{5}{\percent} fino alla parete finale, mentre nella camera laterale l'incremento di attenuazione dopo i \SI{3}{\meter} dalla 
         curva ha fatto salire la packet loss fino a circa \SI{18}{\percent}; le due serie sono riportate dalle linee verdi e arancioni di \autoref{fig:profilo_db}.\\

         \begin{figure}[H]
            \centering
            \begin{tikzpicture}[scale=0.8]
                \begin{axis}[
                    name=audio,
                    width=0.95\textwidth,
                    height=0.5\textwidth,
                    grid=both,
                    axis y line*=left,
                    axis x line*=bottom,
                    xlabel={Distanza lungo il percorso [m]},
                    ylabel={Livello sonoro [dB SPL]},
                    ymin=30,
                    ymax=80,
                    xtick={0,5,10,11.5,13,13.8,15},
                    ytick={30,40,50,60,70,80},
                    legend style={at={(0.02,0.3)},anchor=south west},
                    legend cell align=left
                ]
                    \addplot[thick, color=blue, mark=*] coordinates {
                        (0,70)
                        (5,65)
                        (10,62)
                        (15,55)
                    };
                    \addlegendentry{Percorso rettilineo}
                    \addplot[thick, color=red, mark=square*] coordinates {
                        (0,70)
                        (5,66)
                        (10,66)
                        (11.5,59)
                        (13,52)
                        (13.8,51)
                    };
                    \addlegendentry{Percorso con curva}
                    \addplot[dashed, color=gray] coordinates {
                        (0,35)
                        (15,35)
                    };
                    \addlegendentry{Rumore di fondo}
                \end{axis}
                \begin{axis}[
                    at={(audio.south west)},
                    anchor=south west,
                    width=0.95\textwidth,
                    height=0.5\textwidth,
                    axis y line*=right,
                    axis x line=none,
                    ymin=0,
                    ymax=20,
                    ytick={0,5,10,15,20},
                    ylabel={Packet loss [\%]},
                    legend style={at={(0.3,0.98)},anchor=north west},
                    legend cell align=left
                ]
                    \addplot[thick, color=green!60!black, mark=triangle*] coordinates {
                        (0,0)
                        (5,1)
                        (10,3)
                        (15,5)
                    };
                    \addlegendentry{Packet loss rettilineo}
                    \addplot[thick, color=orange!90!black, mark=diamond*] coordinates {
                        (0,0)
                        (5,1)
                        (10,1)
                        (11.5,4)
                        (13,12)
                        (13.8,18)
                    };
                    \addlegendentry{Packet loss con curva}
                \end{axis}
            \end{tikzpicture}
            \caption{Andamento medio dei livelli sonori misurati lungo il corridoio e corrispondente packet loss. 
            La linea blu mostra la perdita quasi lineare nel tratto rettilineo, la linea rossa il crollo dopo la curva a novanta gradi,
             la linea tratteggiata il rumore di fondo e le curve verdi e arancioni riportano il tasso di pacchetti persi rilevato con il fonometro 
             accanto alla scheda ricevente.}
            \label{fig:profilo_db}
        \end{figure}
        
          In una produzione reale a scopi industriali, come evidenziato nell'analisi
          del \autoref{chap:stato_arte}, l'alimentazione a \SI{3.3}{\volt} verrebbe sostituita da una intorno ai \SI{220}{\volt}, 
          con un incremento di livello pari a
          \begin{equation}
          20\log_{10}\!\left(\tfrac{220}{3.3}\right) \approx \SI{36.5}{\decibel}.
          \end{equation}
          L'emissione iniziale arriverebbe quindi a 
          circa \SI{106.5}{\decibel_{SPL}} e, mantenendo invariata l'attenuazione osservata, porterebbe i livelli lungo il corridoio a \SI{101.5}{\decibel_{SPL}} 
          dopo \SI{5}{\meter}, \SI{98.5}{\decibel_{SPL}} in prossimità della porta e \SI{91.5}{\decibel_{SPL}} contro il muro; nel ramo laterale si stimerebbero 
          \SI{95}{\decibel_{SPL}} tre metri oltre la curva, valori che resterebbero nettamente separati dal rumore di fondo.


        

